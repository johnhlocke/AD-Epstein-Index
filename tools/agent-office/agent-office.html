<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agent Office</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
/* ── Reset & Base ── */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --brick-dark: #8B4513;
  --brick-med: #A0522D;
  --brick-light: #CD853F;
  --brick-grout: #D2B48C;
  --desk-top: #8B6914;
  --desk-front: #6B4F12;
  --desk-shadow: #4A360D;
  --wall-top: #2c2c3a;
  --wall-bottom: #1a1a28;
  --pixel: 4px;
}

body {
  font-family: 'Press Start 2P', monospace;
  background: var(--wall-top);
  color: #e0e0e0;
  overflow-x: hidden;
  min-height: 100vh;
  image-rendering: pixelated;
}

/* ── Brick Floor ── */
.brick-floor {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 120px;
  z-index: 0;
  background:
    repeating-linear-gradient(
      90deg,
      var(--brick-grout) 0px,
      var(--brick-grout) 2px,
      transparent 2px,
      transparent 62px
    ),
    repeating-linear-gradient(
      0deg,
      var(--brick-grout) 0px,
      var(--brick-grout) 2px,
      var(--brick-med) 2px,
      var(--brick-dark) 15px,
      var(--brick-med) 30px,
      var(--brick-grout) 30px,
      var(--brick-grout) 32px,
      var(--brick-light) 32px,
      var(--brick-med) 45px,
      var(--brick-dark) 60px
    );
  background-size: 124px 60px;
  border-top: 4px solid #5a3a1a;
}
.brick-floor::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.1));
}

/* ── Wall ── */
.wall {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 120px;
  background: linear-gradient(180deg, var(--wall-top) 0%, var(--wall-bottom) 100%);
  z-index: 0;
}
.wall::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 8px;
  background: #3a2a1a;
}

/* ── Content Container ── */
.container {
  position: relative;
  z-index: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  padding-bottom: 140px;
}

/* ── Title Banner ── */
.title-banner {
  text-align: center;
  padding: 20px;
  margin-bottom: 16px;
  position: relative;
}
.title-banner h1 {
  font-size: 18px;
  color: #f5c842;
  text-shadow: 2px 2px 0 #8B6914, 4px 4px 0 rgba(0,0,0,0.3);
  letter-spacing: 2px;
  line-height: 1.6;
}
.title-banner .subtitle {
  font-size: 8px;
  color: #aaa;
  margin-top: 8px;
  letter-spacing: 1px;
}
.sparkle {
  position: absolute;
  width: 8px;
  height: 8px;
  background: #f5c842;
  animation: sparkle 1.5s ease-in-out infinite;
}
.sparkle:nth-child(1) { top: 10px; left: 15%; animation-delay: 0s; }
.sparkle:nth-child(2) { top: 25px; right: 15%; animation-delay: 0.5s; }
.sparkle:nth-child(3) { bottom: 10px; left: 25%; animation-delay: 1s; }
.sparkle:nth-child(4) { bottom: 5px; right: 25%; animation-delay: 0.3s; }

@keyframes sparkle {
  0%, 100% { opacity: 0; transform: scale(0.5); }
  50% { opacity: 1; transform: scale(1); }
}

/* ── Stats Bar ── */
.stats-bar {
  display: flex;
  justify-content: center;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 24px;
  padding: 12px;
  background: rgba(0,0,0,0.4);
  border: 2px solid #444;
  border-radius: 2px;
}
.stat-item {
  text-align: center;
  padding: 8px 16px;
  background: rgba(255,255,255,0.05);
  border: 1px solid #555;
  min-width: 120px;
}
.stat-value {
  font-size: 20px;
  color: #f5c842;
  display: block;
  margin-bottom: 4px;
}
.stat-label {
  font-size: 7px;
  color: #999;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* ── Agent Grid ── */
.agent-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

/* ── Agent Station ── */
.agent-station {
  background: rgba(0,0,0,0.35);
  border: 2px solid #444;
  border-radius: 2px;
  padding: 16px;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 280px;
}

/* ── Speech Bubble ── */
.speech-bubble {
  background: #fff;
  color: #222;
  font-size: 7px;
  line-height: 1.5;
  padding: 8px 10px;
  border-radius: 2px;
  position: relative;
  margin-bottom: 12px;
  max-width: 220px;
  text-align: center;
  animation: bubble-in 0.3s ease-out;
  word-break: break-word;
}
.speech-bubble::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 8px solid #fff;
}

@keyframes bubble-in {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ── Pixel Character ── */
.character-container {
  position: relative;
  width: 80px;
  height: 96px;
  margin-bottom: 8px;
}
.character {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 1px;
  height: 1px;
}
.character.idle { animation: idle-bob 2s ease-in-out infinite; }
.character.working { animation: working-type 0.4s steps(2) infinite; }
.character.error { animation: error-shake 0.5s ease-in-out infinite; }

@keyframes idle-bob {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(-3px); }
}
@keyframes working-type {
  0% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(-2px); }
}
@keyframes error-shake {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  25% { transform: translateX(calc(-50% + 2px)) translateY(0); }
  75% { transform: translateX(calc(-50% - 2px)) translateY(0); }
}

/* ── Desk ── */
.desk {
  width: 100%;
  max-width: 200px;
  position: relative;
  margin-bottom: 8px;
}
.desk-surface {
  height: 12px;
  background: var(--desk-top);
  border: 2px solid var(--desk-shadow);
  border-bottom: none;
  border-radius: 2px 2px 0 0;
  position: relative;
}
.desk-front {
  height: 20px;
  background: var(--desk-front);
  border: 2px solid var(--desk-shadow);
  border-top: none;
}
.desk-items {
  position: absolute;
  top: -14px;
  left: 8px;
  right: 8px;
  display: flex;
  justify-content: center;
  gap: 12px;
}

/* ── Desk Item Pixel Icons ── */
.desk-icon {
  width: 12px;
  height: 12px;
  position: relative;
  image-rendering: pixelated;
}
.desk-icon::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
}

/* Magnifier */
.icon-magnifier { color: #5dade2; }
.icon-magnifier::before {
  width: 12px; height: 12px;
  box-shadow:
    2px 0 0 #5dade2, 4px 0 0 #5dade2, 6px 0 0 #5dade2,
    0 2px 0 #5dade2, 8px 2px 0 #5dade2,
    0 4px 0 #5dade2, 8px 4px 0 #5dade2,
    0 6px 0 #5dade2, 8px 6px 0 #5dade2,
    2px 8px 0 #5dade2, 4px 8px 0 #5dade2, 6px 8px 0 #5dade2,
    8px 8px 0 #8B6914, 10px 10px 0 #8B6914, 12px 12px 0 #8B6914;
}

/* Document */
.icon-document { color: #ecf0f1; }
.icon-document::before {
  width: 12px; height: 12px;
  box-shadow:
    0 0 0 #ecf0f1, 2px 0 0 #ecf0f1, 4px 0 0 #ecf0f1, 6px 0 0 #ecf0f1,
    0 2px 0 #ecf0f1, 2px 2px 0 #bdc3c7, 4px 2px 0 #bdc3c7, 6px 2px 0 #ecf0f1, 8px 2px 0 #ecf0f1,
    0 4px 0 #ecf0f1, 2px 4px 0 #bdc3c7, 4px 4px 0 #bdc3c7, 6px 4px 0 #ecf0f1, 8px 4px 0 #ecf0f1,
    0 6px 0 #ecf0f1, 2px 6px 0 #bdc3c7, 4px 6px 0 #bdc3c7, 6px 6px 0 #ecf0f1, 8px 6px 0 #ecf0f1,
    0 8px 0 #ecf0f1, 2px 8px 0 #ecf0f1, 4px 8px 0 #ecf0f1, 6px 8px 0 #ecf0f1, 8px 8px 0 #ecf0f1,
    0 10px 0 #ecf0f1, 2px 10px 0 #ecf0f1, 4px 10px 0 #ecf0f1, 6px 10px 0 #ecf0f1, 8px 10px 0 #ecf0f1;
}

/* Folder */
.icon-folder { color: #f39c12; }
.icon-folder::before {
  width: 12px; height: 12px;
  box-shadow:
    0 0 0 #f39c12, 2px 0 0 #f39c12, 4px 0 0 #f39c12,
    0 2px 0 #f39c12, 2px 2px 0 #f39c12, 4px 2px 0 #f39c12, 6px 2px 0 #f39c12, 8px 2px 0 #f39c12, 10px 2px 0 #f39c12,
    0 4px 0 #e67e22, 2px 4px 0 #e67e22, 4px 4px 0 #e67e22, 6px 4px 0 #e67e22, 8px 4px 0 #e67e22, 10px 4px 0 #e67e22,
    0 6px 0 #e67e22, 2px 6px 0 #e67e22, 4px 6px 0 #e67e22, 6px 6px 0 #e67e22, 8px 6px 0 #e67e22, 10px 6px 0 #e67e22,
    0 8px 0 #f39c12, 2px 8px 0 #f39c12, 4px 8px 0 #f39c12, 6px 8px 0 #f39c12, 8px 8px 0 #f39c12, 10px 8px 0 #f39c12;
}

/* Database */
.icon-database { color: #1abc9c; }
.icon-database::before {
  width: 12px; height: 12px;
  box-shadow:
    2px 0 0 #1abc9c, 4px 0 0 #1abc9c, 6px 0 0 #1abc9c, 8px 0 0 #1abc9c,
    0 2px 0 #16a085, 2px 2px 0 #1abc9c, 4px 2px 0 #1abc9c, 6px 2px 0 #1abc9c, 8px 2px 0 #1abc9c, 10px 2px 0 #16a085,
    0 4px 0 #16a085, 10px 4px 0 #16a085,
    0 6px 0 #16a085, 2px 6px 0 #1abc9c, 4px 6px 0 #1abc9c, 6px 6px 0 #1abc9c, 8px 6px 0 #1abc9c, 10px 6px 0 #16a085,
    0 8px 0 #16a085, 10px 8px 0 #16a085,
    2px 10px 0 #1abc9c, 4px 10px 0 #1abc9c, 6px 10px 0 #1abc9c, 8px 10px 0 #1abc9c;
}

/* Globe */
.icon-globe { color: #3498db; }
.icon-globe::before {
  width: 12px; height: 12px;
  box-shadow:
    4px 0 0 #3498db, 6px 0 0 #3498db,
    2px 2px 0 #2ecc71, 4px 2px 0 #3498db, 6px 2px 0 #2ecc71, 8px 2px 0 #3498db,
    0 4px 0 #3498db, 2px 4px 0 #3498db, 4px 4px 0 #2ecc71, 6px 4px 0 #3498db, 8px 4px 0 #2ecc71, 10px 4px 0 #3498db,
    0 6px 0 #3498db, 2px 6px 0 #2ecc71, 4px 6px 0 #3498db, 6px 6px 0 #2ecc71, 8px 6px 0 #3498db, 10px 6px 0 #3498db,
    2px 8px 0 #3498db, 4px 8px 0 #3498db, 6px 8px 0 #2ecc71, 8px 8px 0 #3498db,
    4px 10px 0 #3498db, 6px 10px 0 #3498db;
}

/* Book */
.icon-book { color: #e74c3c; }
.icon-book::before {
  width: 12px; height: 12px;
  box-shadow:
    0 0 0 #c0392b, 2px 0 0 #e74c3c, 4px 0 0 #e74c3c, 6px 0 0 #e74c3c, 8px 0 0 #e74c3c,
    0 2px 0 #c0392b, 2px 2px 0 #ecf0f1, 4px 2px 0 #bdc3c7, 6px 2px 0 #ecf0f1, 8px 2px 0 #e74c3c,
    0 4px 0 #c0392b, 2px 4px 0 #ecf0f1, 4px 4px 0 #bdc3c7, 6px 4px 0 #ecf0f1, 8px 4px 0 #e74c3c,
    0 6px 0 #c0392b, 2px 6px 0 #ecf0f1, 4px 6px 0 #bdc3c7, 6px 6px 0 #ecf0f1, 8px 6px 0 #e74c3c,
    0 8px 0 #c0392b, 2px 8px 0 #ecf0f1, 4px 8px 0 #bdc3c7, 6px 8px 0 #ecf0f1, 8px 8px 0 #e74c3c,
    0 10px 0 #c0392b, 2px 10px 0 #e74c3c, 4px 10px 0 #e74c3c, 6px 10px 0 #e74c3c, 8px 10px 0 #e74c3c;
}

/* Pencil */
.icon-pencil { color: #f1c40f; }
.icon-pencil::before {
  width: 12px; height: 12px;
  box-shadow:
    10px 0 0 #e67e22,
    8px 2px 0 #f1c40f, 10px 2px 0 #e67e22,
    6px 4px 0 #f1c40f, 8px 4px 0 #f1c40f,
    4px 6px 0 #f1c40f, 6px 6px 0 #f1c40f,
    2px 8px 0 #f1c40f, 4px 8px 0 #f1c40f,
    0 10px 0 #95a5a6, 2px 10px 0 #f1c40f;
}

/* Clipboard */
.icon-clipboard { color: #8B6914; }
.icon-clipboard::before {
  width: 12px; height: 12px;
  box-shadow:
    4px 0 0 #8B6914, 6px 0 0 #8B6914,
    2px 2px 0 #8B6914, 4px 2px 0 #CD853F, 6px 2px 0 #CD853F, 8px 2px 0 #8B6914,
    2px 4px 0 #8B6914, 4px 4px 0 #ecf0f1, 6px 4px 0 #bdc3c7, 8px 4px 0 #8B6914,
    2px 6px 0 #8B6914, 4px 6px 0 #ecf0f1, 6px 6px 0 #bdc3c7, 8px 6px 0 #8B6914,
    2px 8px 0 #8B6914, 4px 8px 0 #ecf0f1, 6px 8px 0 #bdc3c7, 8px 8px 0 #8B6914,
    2px 10px 0 #8B6914, 4px 10px 0 #8B6914, 6px 10px 0 #8B6914, 8px 10px 0 #8B6914;
}

/* Gear */
.icon-gear { color: #95a5a6; }
.icon-gear::before {
  width: 12px; height: 12px;
  box-shadow:
    4px 0 0 #95a5a6, 6px 0 0 #95a5a6,
    2px 2px 0 #7f8c8d, 4px 2px 0 #95a5a6, 6px 2px 0 #95a5a6, 8px 2px 0 #7f8c8d,
    0 4px 0 #95a5a6, 2px 4px 0 #95a5a6, 4px 4px 0 #7f8c8d, 6px 4px 0 #7f8c8d, 8px 4px 0 #95a5a6, 10px 4px 0 #95a5a6,
    0 6px 0 #95a5a6, 2px 6px 0 #95a5a6, 4px 6px 0 #7f8c8d, 6px 6px 0 #7f8c8d, 8px 6px 0 #95a5a6, 10px 6px 0 #95a5a6,
    2px 8px 0 #7f8c8d, 4px 8px 0 #95a5a6, 6px 8px 0 #95a5a6, 8px 8px 0 #7f8c8d,
    4px 10px 0 #95a5a6, 6px 10px 0 #95a5a6;
}

/* Eye */
.icon-eye { color: #3498db; }
.icon-eye::before {
  width: 12px; height: 12px;
  box-shadow:
    4px 2px 0 #ecf0f1, 6px 2px 0 #ecf0f1,
    2px 4px 0 #ecf0f1, 4px 4px 0 #3498db, 6px 4px 0 #2c3e50, 8px 4px 0 #ecf0f1,
    0 6px 0 #ecf0f1, 2px 6px 0 #3498db, 4px 6px 0 #2c3e50, 6px 6px 0 #3498db, 8px 6px 0 #ecf0f1, 10px 6px 0 #ecf0f1,
    2px 8px 0 #ecf0f1, 4px 8px 0 #ecf0f1, 6px 8px 0 #ecf0f1, 8px 8px 0 #ecf0f1;
}

/* Detective Hat */
.icon-detective-hat { color: #2c3e50; }
.icon-detective-hat::before {
  width: 12px; height: 12px;
  box-shadow:
    4px 2px 0 #2c3e50, 6px 2px 0 #2c3e50,
    2px 4px 0 #2c3e50, 4px 4px 0 #34495e, 6px 4px 0 #34495e, 8px 4px 0 #2c3e50,
    2px 6px 0 #2c3e50, 4px 6px 0 #34495e, 6px 6px 0 #34495e, 8px 6px 0 #2c3e50,
    0 8px 0 #2c3e50, 2px 8px 0 #2c3e50, 4px 8px 0 #2c3e50, 6px 8px 0 #2c3e50, 8px 8px 0 #2c3e50, 10px 8px 0 #2c3e50;
}

/* Map */
.icon-map { color: #f0e6d2; }
.icon-map::before {
  width: 12px; height: 12px;
  box-shadow:
    0 0 0 #f0e6d2, 2px 0 0 #f0e6d2, 4px 0 0 #d4c5a9, 6px 0 0 #f0e6d2, 8px 0 0 #f0e6d2, 10px 0 0 #f0e6d2,
    0 2px 0 #f0e6d2, 2px 2px 0 #e74c3c, 4px 2px 0 #f0e6d2, 6px 2px 0 #d4c5a9, 8px 2px 0 #f0e6d2, 10px 2px 0 #f0e6d2,
    0 4px 0 #f0e6d2, 2px 4px 0 #f0e6d2, 4px 4px 0 #d4c5a9, 6px 4px 0 #f0e6d2, 8px 4px 0 #e74c3c, 10px 4px 0 #f0e6d2,
    0 6px 0 #d4c5a9, 2px 6px 0 #f0e6d2, 4px 6px 0 #f0e6d2, 6px 6px 0 #d4c5a9, 8px 6px 0 #f0e6d2, 10px 6px 0 #f0e6d2,
    0 8px 0 #f0e6d2, 2px 8px 0 #d4c5a9, 4px 8px 0 #f0e6d2, 6px 8px 0 #f0e6d2, 8px 8px 0 #d4c5a9, 10px 8px 0 #f0e6d2;
}

/* Phone */
.icon-phone { color: #2c3e50; }
.icon-phone::before {
  width: 12px; height: 12px;
  box-shadow:
    2px 0 0 #2c3e50, 4px 0 0 #2c3e50,
    2px 2px 0 #34495e, 4px 2px 0 #34495e,
    2px 4px 0 #2c3e50, 4px 4px 0 #2c3e50,
    4px 6px 0 #2c3e50,
    6px 6px 0 #2c3e50, 6px 8px 0 #2c3e50,
    6px 10px 0 #2c3e50, 8px 10px 0 #2c3e50;
}

/* ── Nameplate ── */
.nameplate {
  background: #1a1a2e;
  border: 2px solid #333;
  padding: 4px 12px;
  text-align: center;
  margin-bottom: 6px;
  width: 100%;
  max-width: 200px;
}
.nameplate .agent-name {
  font-size: 9px;
  color: #f5c842;
  letter-spacing: 1px;
}
.nameplate .agent-role {
  font-size: 6px;
  color: #888;
  margin-top: 2px;
}

/* ── Status Badge ── */
.status-badge {
  font-size: 7px;
  padding: 3px 8px;
  border-radius: 2px;
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 6px;
}
.status-working {
  background: #27ae60;
  color: #fff;
  animation: status-pulse 1.5s ease-in-out infinite;
}
.status-idle {
  background: #555;
  color: #aaa;
}
.status-done {
  background: #f39c12;
  color: #fff;
}
.status-error {
  background: #c0392b;
  color: #fff;
  animation: status-pulse 0.8s ease-in-out infinite;
}
@keyframes status-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* ── Progress Bar ── */
.progress-container {
  width: 100%;
  max-width: 200px;
  margin-top: 4px;
}
.progress-bar {
  height: 8px;
  background: #222;
  border: 1px solid #555;
  position: relative;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: #27ae60;
  transition: width 0.5s ease;
}
.progress-text {
  font-size: 6px;
  color: #888;
  text-align: center;
  margin-top: 2px;
}

/* ── Activity Log ── */
.activity-log {
  background: rgba(0,0,0,0.5);
  border: 2px solid #444;
  border-radius: 2px;
  padding: 12px;
  max-height: 200px;
  overflow-y: auto;
}
.activity-log h3 {
  font-size: 9px;
  color: #f5c842;
  margin-bottom: 10px;
  letter-spacing: 1px;
}
.log-entry {
  font-size: 7px;
  padding: 4px 0;
  border-bottom: 1px solid #333;
  display: flex;
  gap: 8px;
  line-height: 1.5;
}
.log-entry:last-child { border-bottom: none; }
.log-time {
  color: #666;
  flex-shrink: 0;
  width: 40px;
}
.log-agent {
  color: #f5c842;
  flex-shrink: 0;
  width: 70px;
}
.log-event {
  color: #ccc;
}

/* ── Sound Toggle ── */
.sound-toggle {
  position: fixed;
  bottom: 130px;
  right: 16px;
  z-index: 10;
  background: rgba(0,0,0,0.6);
  border: 2px solid #444;
  color: #888;
  font-family: 'Press Start 2P', monospace;
  font-size: 7px;
  padding: 6px 10px;
  cursor: pointer;
  border-radius: 2px;
  transition: color 0.2s;
}
.sound-toggle:hover { color: #f5c842; }
.sound-toggle.active { color: #27ae60; border-color: #27ae60; }

/* ── Scrollbar ── */
.activity-log::-webkit-scrollbar { width: 6px; }
.activity-log::-webkit-scrollbar-track { background: #111; }
.activity-log::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

/* ── Loading ── */
.loading {
  text-align: center;
  padding: 40px;
  font-size: 10px;
  color: #888;
  animation: blink 1s steps(2) infinite;
}
@keyframes blink {
  50% { opacity: 0; }
}

/* ── Responsive ── */
@media (max-width: 600px) {
  .title-banner h1 { font-size: 12px; }
  .agent-grid { grid-template-columns: 1fr; }
  .stats-bar { gap: 4px; }
  .stat-item { min-width: 80px; padding: 6px 8px; }
  .stat-value { font-size: 14px; }
}
</style>
</head>
<body>

<div class="wall"></div>
<div class="brick-floor"></div>

<div class="container">
  <div class="title-banner" id="title-banner">
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <div class="sparkle"></div>
    <h1 id="main-title">AGENT OFFICE</h1>
    <div class="subtitle" id="main-subtitle">loading...</div>
  </div>

  <div class="stats-bar" id="stats-bar">
    <div class="loading">LOADING STATUS...</div>
  </div>

  <div class="agent-grid" id="agent-grid"></div>

  <div class="activity-log" id="activity-log">
    <h3>ACTIVITY LOG</h3>
    <div id="log-entries"></div>
  </div>
</div>

<button class="sound-toggle" id="sound-toggle" title="Toggle ambient sound">SFX OFF</button>

<script>
// ── Configuration ──
const params = new URLSearchParams(window.location.search);
const STATUS_URL = params.get('status') || 'status.json';
const POLL_MS = parseInt(params.get('poll') || '5000', 10);
const FORCE_DEMO = params.get('demo') === 'true';

// ── Pixel Character Generator ──
// Generates box-shadow CSS for a 10x16 pixel character with configurable shirt color
function generateCharacterShadow(shirtColor) {
  const P = 4; // pixel size
  const skin = '#f5cba7';
  const skinDark = '#e0ac69';
  const hair = '#4a3728';
  const eye = '#2c3e50';
  const pants = '#34495e';
  const shoe = '#2c3e50';
  const shirt = shirtColor || '#e74c3c';
  const shirtDark = darkenColor(shirt, 30);

  // 10 wide x 16 tall pixel grid — each entry is [x, y, color]
  const pixels = [
    // Hair (row 0-1)
    [3,0,hair],[4,0,hair],[5,0,hair],[6,0,hair],
    [2,1,hair],[3,1,hair],[4,1,hair],[5,1,hair],[6,1,hair],[7,1,hair],
    // Face (row 2-4)
    [2,2,skin],[3,2,skin],[4,2,skin],[5,2,skin],[6,2,skin],[7,2,skin],
    [2,3,skin],[3,3,eye],[4,3,skin],[5,3,skin],[6,3,eye],[7,3,skin],
    [2,4,skin],[3,4,skin],[4,4,skin],[5,4,skinDark],[6,4,skin],[7,4,skin],
    // Neck (row 5)
    [4,5,skin],[5,5,skin],
    // Shirt (row 6-9)
    [2,6,shirt],[3,6,shirt],[4,6,shirt],[5,6,shirt],[6,6,shirt],[7,6,shirt],
    [1,7,shirt],[2,7,shirt],[3,7,shirt],[4,7,shirtDark],[5,7,shirtDark],[6,7,shirt],[7,7,shirt],[8,7,shirt],
    [1,8,shirt],[2,8,shirtDark],[3,8,shirt],[4,8,shirtDark],[5,8,shirtDark],[6,8,shirt],[7,8,shirtDark],[8,8,shirt],
    [2,9,shirt],[3,9,shirtDark],[4,9,shirt],[5,9,shirt],[6,9,shirtDark],[7,9,shirt],
    // Arms (hands at sides)
    [0,7,skin],[9,7,skin],
    [0,8,skin],[9,8,skin],
    // Pants (row 10-12)
    [3,10,pants],[4,10,pants],[5,10,pants],[6,10,pants],
    [3,11,pants],[4,11,pants],[5,11,pants],[6,11,pants],
    [3,12,pants],[4,12,pants],[6,12,pants],[7,12,pants],
    // Shoes (row 13)
    [2,13,shoe],[3,13,shoe],[4,13,shoe],[6,13,shoe],[7,13,shoe],[8,13,shoe],
  ];

  return pixels.map(([x, y, c]) => `${x * P}px ${y * P}px 0 ${c}`).join(',');
}

function darkenColor(hex, amount) {
  const num = parseInt(hex.replace('#', ''), 16);
  const r = Math.max(0, (num >> 16) - amount);
  const g = Math.max(0, ((num >> 8) & 0x00FF) - amount);
  const b = Math.max(0, (num & 0x0000FF) - amount);
  return `#${(r << 16 | g << 8 | b).toString(16).padStart(6, '0')}`;
}

// ── State ──
let currentState = null;
let audioCtx = null;
let soundOn = false;
let ambientOsc = null;

// ── Rendering ──
function renderTitle(data) {
  document.getElementById('main-title').textContent = data.title || 'AGENT OFFICE';
  document.getElementById('main-subtitle').textContent = data.subtitle || '';
  document.title = data.title || 'Agent Office';
}

function renderStats(stats) {
  const bar = document.getElementById('stats-bar');
  if (!stats || !stats.length) {
    bar.innerHTML = '<div class="stat-item"><span class="stat-value">--</span><span class="stat-label">No data</span></div>';
    return;
  }
  bar.innerHTML = stats.map(s =>
    `<div class="stat-item">
      <span class="stat-value">${s.value}</span>
      <span class="stat-label">${s.label}</span>
    </div>`
  ).join('');
}

function renderAgents(agents) {
  const grid = document.getElementById('agent-grid');
  if (!agents || !agents.length) {
    grid.innerHTML = '<div class="loading">NO AGENTS FOUND</div>';
    return;
  }
  grid.innerHTML = agents.map(a => {
    const statusClass = `status-${a.status || 'idle'}`;
    const animClass = a.status === 'working' ? 'working' : a.status === 'error' ? 'error' : 'idle';
    const charShadow = generateCharacterShadow(a.color || '#e74c3c');
    const statusLabel = {
      working: 'WORKING...',
      idle: 'IDLE',
      done: 'DONE',
      error: 'ERROR'
    }[a.status] || 'IDLE';

    const deskItemsHtml = (a.deskItems || []).map(item =>
      `<div class="desk-icon icon-${item}" title="${item}"></div>`
    ).join('');

    let progressHtml = '';
    if (a.progress) {
      const pct = a.progress.total > 0
        ? Math.round((a.progress.current / a.progress.total) * 100)
        : 0;
      progressHtml = `
        <div class="progress-container">
          <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
          <div class="progress-text">${a.progress.current} / ${a.progress.total}</div>
        </div>`;
    }

    return `
      <div class="agent-station" data-agent-id="${a.id}">
        <div class="speech-bubble">${escHtml(a.message || '...')}</div>
        <div class="character-container">
          <div class="character ${animClass}" style="box-shadow:${charShadow};"></div>
        </div>
        <div class="desk">
          <div class="desk-surface">
            <div class="desk-items">${deskItemsHtml}</div>
          </div>
          <div class="desk-front"></div>
        </div>
        <div class="nameplate">
          <div class="agent-name">${escHtml(a.name || 'AGENT')}</div>
          <div class="agent-role">${escHtml(a.role || '')}</div>
        </div>
        <div class="status-badge ${statusClass}">${statusLabel}</div>
        ${progressHtml}
      </div>`;
  }).join('');
}

function renderLog(log) {
  const container = document.getElementById('log-entries');
  if (!log || !log.length) {
    container.innerHTML = '<div class="log-entry"><span class="log-event">No activity yet...</span></div>';
    return;
  }
  container.innerHTML = log.map(entry =>
    `<div class="log-entry">
      <span class="log-time">${escHtml(entry.time || '')}</span>
      <span class="log-agent">${escHtml(entry.agent || '')}</span>
      <span class="log-event">${escHtml(entry.event || '')}</span>
    </div>`
  ).join('');
}

function escHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function renderAll(data) {
  renderTitle(data);
  renderStats(data.stats);
  renderAgents(data.agents);
  renderLog(data.log);
}

// ── Demo Data ──
const DEMO_DATA = {
  title: "DEMO \u2014 AGENT OFFICE",
  subtitle: "Sample multi-agent pipeline",
  timestamp: new Date().toISOString(),
  agents: [
    {
      id: "researcher",
      name: "Scout",
      role: "Discovers items",
      status: "done",
      message: "Found 163 items in the archive!",
      color: "#e74c3c",
      deskItems: ["magnifier", "globe"],
      progress: { current: 163, total: 163 }
    },
    {
      id: "courier",
      name: "Courier",
      role: "Downloads files",
      status: "working",
      message: "Downloading item 31 of 163...",
      color: "#3498db",
      deskItems: ["folder", "document"],
      progress: { current: 31, total: 163 }
    },
    {
      id: "reader",
      name: "Reader",
      role: "Extracts data",
      status: "idle",
      message: "Waiting for more files...",
      color: "#2ecc71",
      deskItems: ["book", "pencil"],
      progress: { current: 15, total: 31 }
    },
    {
      id: "detective",
      name: "Detective",
      role: "Cross-references names",
      status: "idle",
      message: "1 match found so far",
      color: "#9b59b6",
      deskItems: ["detective-hat", "clipboard"],
      progress: { current: 1, total: 15 }
    }
  ],
  stats: [
    { label: "Discovered", value: 163 },
    { label: "Downloaded", value: 31 },
    { label: "Extracted", value: 15 },
    { label: "Matches", value: 1 }
  ],
  log: [
    { time: "14:30", agent: "Courier", event: "Downloading issue #31..." },
    { time: "14:28", agent: "Reader", event: "Extracted 8 features from November 2013" },
    { time: "14:25", agent: "Detective", event: "Found match: Miranda Brooks" },
    { time: "14:20", agent: "Reader", event: "Extracted 6 features from October 2013" },
    { time: "14:15", agent: "Courier", event: "Downloaded issue #30" },
    { time: "14:10", agent: "Scout", event: "Discovery complete \u2014 163 issues indexed" }
  ]
};

// ── Fetch & Poll ──
async function fetchStatus() {
  if (FORCE_DEMO) {
    renderAll(DEMO_DATA);
    return;
  }

  try {
    const resp = await fetch(STATUS_URL + '?t=' + Date.now());
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
    const data = await resp.json();
    currentState = data;
    renderAll(data);
  } catch (e) {
    // Try demo-status.json as fallback
    try {
      const demoResp = await fetch('demo-status.json?t=' + Date.now());
      if (demoResp.ok) {
        const demoData = await demoResp.json();
        currentState = demoData;
        renderAll(demoData);
        return;
      }
    } catch (_) {}

    // Final fallback: built-in demo
    console.log('Using built-in demo data:', e.message);
    renderAll(DEMO_DATA);
  }
}

// ── Sound ──
function initSound() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

function toggleSound() {
  const btn = document.getElementById('sound-toggle');
  soundOn = !soundOn;

  if (soundOn) {
    if (!audioCtx) initSound();
    btn.textContent = 'SFX ON';
    btn.classList.add('active');
    startAmbient();
  } else {
    btn.textContent = 'SFX OFF';
    btn.classList.remove('active');
    stopAmbient();
  }
}

function startAmbient() {
  if (!audioCtx || ambientOsc) return;

  // Gentle low-frequency hum (like a retro computer room)
  ambientOsc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  ambientOsc.type = 'sine';
  ambientOsc.frequency.value = 80;
  gain.gain.value = 0.03;
  ambientOsc.connect(gain);
  gain.connect(audioCtx.destination);
  ambientOsc.start();

  // Add a secondary higher tone
  const osc2 = audioCtx.createOscillator();
  const gain2 = audioCtx.createGain();
  osc2.type = 'triangle';
  osc2.frequency.value = 220;
  gain2.gain.value = 0.008;
  osc2.connect(gain2);
  gain2.connect(audioCtx.destination);
  osc2.start();
  ambientOsc._secondary = { osc: osc2, gain: gain2 };
}

function stopAmbient() {
  if (ambientOsc) {
    ambientOsc.stop();
    if (ambientOsc._secondary) {
      ambientOsc._secondary.osc.stop();
    }
    ambientOsc = null;
  }
}

// ── Init ──
document.getElementById('sound-toggle').addEventListener('click', toggleSound);

fetchStatus();
setInterval(fetchStatus, POLL_MS);
</script>
</body>
</html>
